# Jiminy Desktop App

Menu bar app shell for Jiminy (macOS only).

## Run

```bash
npm install
npm start
```

## Run (with .env)

```bash
npm run dev
```

Loads `code/desktopapp/.env` and starts Electron with those variables.

## Tests

```bash
npm test
```

## E2E Tests (Playwright)

```bash
npm run test:e2e
```

E2E helpers:

-   `JIMINY_E2E=1` opens the Settings window on launch and bypasses native dialogs.
-   `JIMINY_E2E_CONTEXT_PATH` supplies the folder picker result.
-   `JIMINY_SETTINGS_DIR` overrides the settings storage directory.
-   `JIMINY_LLM_MOCK=1` replaces Gemini calls with a mock summarizer.
-   `JIMINY_LLM_MOCK_TEXT` sets the mock summary text (default: `gibberish`).

## Notes

-   The app runs from the macOS menu bar with a Settings window that stores the Context Folder Path in `~/.jiminy/settings.json`.
-   The Settings window includes a Context Graph sync action that writes summaries to `~/.jiminy/context-tree.json`.
-   Auto-launch on login is enabled via Electron login item settings.

## Context Graph (Current Implementation)

-   **Source of truth:** The Context Folder Path saved in `~/.jiminy/settings.json`.
-   **Scan scope:** Recursively walks the context folder and only includes `.md` and `.txt` files. Other files are skipped with a log entry.
-   **Cycle safety:** Keeps a visited set of resolved directory paths and warns when a cycle is detected (including symlink loops).
-   **Node limit:** Hard cap of 100 nodes (folders + files). Sync fails with an error if exceeded.
-   **Summaries:** File summaries are generated by the LLM; folder summaries are generated by summarizing file summaries.
-   **Caching:** File summaries are reused only if the file content hash matches _and_ the cached summary is nonâ€‘empty.
-   **Output:** Writes a single JSON graph to `~/.jiminy/context-tree.json` with nodes keyed by stable ids.

## Context Graph Dev Notes

-   **LLM config:** Uses `LLM_API_KEY` and the default Gemini model in `code/desktopapp/llms.js`. For tests or local runs, set `JIMINY_LLM_MOCK=1` (optionally `JIMINY_LLM_MOCK_TEXT`) to bypass live calls.
-   **IPC surface:** Main process exposes `contextGraph:sync` and streams progress via `contextGraph:progress`. Renderer subscribes through `window.jiminy.onContextGraphProgress`.
-   **Schema reference:** See `code/desktopapp/context-graph/nodes.js` for node fields and `code/desktopapp/context-graph/sync.js` for the graph root shape.
-   **Errors vs warnings:** Sync returns `errors` (fatal issues like unreadable files or empty LLM responses) and `warnings` (cycle detections). Renderer shows warnings but allows completion.
-   **Tests:** `code/desktopapp/test/llms.test.js` makes a live Gemini call and will fail without a network connection and a valid `LLM_API_KEY`.

## License

[CC0 1.0 (Public Domain)](LICENSE.md)
